(function() {
  var formatSql, sql;

  sql = null;

  module.exports = {
    activate: function(state) {
      return atom.commands.add('atom-workspace', {
        'format:sql': function() {
          return formatSql();
        }
      });
    }
  };

  formatSql = function() {
    var editor, error, lastChar, selectedText, text, tokens;
    editor = atom.workspace.getActiveTextEditor();
    if (editor == null) {
      return;
    }
    if (sql == null) {
      sql = require('sql-parser');
    }
    selectedText = editor.getSelectedText();
    lastChar = '';
    if (selectedText) {
      if (selectedText.substr(selectedText.length - 1) === ';') {
        lastChar = ';';
        text = selectedText.substring(0, editor.getText().length - 1);
      } else {
        text = selectedText;
      }
      try {
        tokens = sql.lexer.tokenize(text);
        return editor.insertText(sql.parser.parse(tokens).toString() + lastChar);
      } catch (_error) {
        error = _error;
        return console.warn(error);
      }
    } else {
      if (editor.getText().substr(editor.getText().length - 1) === ';') {
        lastChar = ';';
        text = editor.getText().substring(0, editor.getText().length - 1);
      } else {
        text = editor.getText();
      }
      try {
        tokens = sql.lexer.tokenize(text);
        return editor.setText(sql.parser.parse(tokens).toString() + lastChar);
      } catch (_error) {
        error = _error;
        return console.warn(error);
      }
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiL2hvbWUveHkvLmF0b20vcGFja2FnZXMvZm9ybWF0LXNxbC9saWIvZm9ybWF0LXNxbC5jb2ZmZWUiCiAgXSwKICAibmFtZXMiOiBbXSwKICAibWFwcGluZ3MiOiAiQUFBQTtBQUFBLE1BQUEsY0FBQTs7QUFBQSxFQUFBLEdBQUEsR0FBTSxJQUFOLENBQUE7O0FBQUEsRUFFQSxNQUFNLENBQUMsT0FBUCxHQUNFO0FBQUEsSUFBQSxRQUFBLEVBQVUsU0FBQyxLQUFELEdBQUE7YUFDUixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQWQsQ0FBa0IsZ0JBQWxCLEVBQ0U7QUFBQSxRQUFBLFlBQUEsRUFBYyxTQUFBLEdBQUE7aUJBQ1osU0FBQSxDQUFBLEVBRFk7UUFBQSxDQUFkO09BREYsRUFEUTtJQUFBLENBQVY7R0FIRixDQUFBOztBQUFBLEVBUUEsU0FBQSxHQUFZLFNBQUEsR0FBQTtBQUNWLFFBQUEsbURBQUE7QUFBQSxJQUFBLE1BQUEsR0FBUyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFmLENBQUEsQ0FBVCxDQUFBO0FBQ0EsSUFBQSxJQUFjLGNBQWQ7QUFBQSxZQUFBLENBQUE7S0FEQTs7TUFHQSxNQUFPLE9BQUEsQ0FBUSxZQUFSO0tBSFA7QUFBQSxJQUtBLFlBQUEsR0FBZSxNQUFNLENBQUMsZUFBUCxDQUFBLENBTGYsQ0FBQTtBQUFBLElBT0EsUUFBQSxHQUFXLEVBUFgsQ0FBQTtBQVFBLElBQUEsSUFBRyxZQUFIO0FBQ0UsTUFBQSxJQUFHLFlBQVksQ0FBQyxNQUFiLENBQW9CLFlBQVksQ0FBQyxNQUFiLEdBQXNCLENBQTFDLENBQUEsS0FBZ0QsR0FBbkQ7QUFDRSxRQUFBLFFBQUEsR0FBVyxHQUFYLENBQUE7QUFBQSxRQUNBLElBQUEsR0FBTyxZQUFZLENBQUMsU0FBYixDQUF1QixDQUF2QixFQUEwQixNQUFNLENBQUMsT0FBUCxDQUFBLENBQWdCLENBQUMsTUFBakIsR0FBMEIsQ0FBcEQsQ0FEUCxDQURGO09BQUEsTUFBQTtBQUlFLFFBQUEsSUFBQSxHQUFPLFlBQVAsQ0FKRjtPQUFBO0FBTUE7QUFDRSxRQUFBLE1BQUEsR0FBUyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVYsQ0FBbUIsSUFBbkIsQ0FBVCxDQUFBO2VBQ0EsTUFBTSxDQUFDLFVBQVAsQ0FBa0IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFYLENBQWlCLE1BQWpCLENBQXdCLENBQUMsUUFBekIsQ0FBQSxDQUFBLEdBQXNDLFFBQXhELEVBRkY7T0FBQSxjQUFBO0FBSUUsUUFESSxjQUNKLENBQUE7ZUFBQSxPQUFPLENBQUMsSUFBUixDQUFhLEtBQWIsRUFKRjtPQVBGO0tBQUEsTUFBQTtBQWNFLE1BQUEsSUFBRyxNQUFNLENBQUMsT0FBUCxDQUFBLENBQWdCLENBQUMsTUFBakIsQ0FBd0IsTUFBTSxDQUFDLE9BQVAsQ0FBQSxDQUFnQixDQUFDLE1BQWpCLEdBQTBCLENBQWxELENBQUEsS0FBd0QsR0FBM0Q7QUFDRSxRQUFBLFFBQUEsR0FBVyxHQUFYLENBQUE7QUFBQSxRQUNBLElBQUEsR0FBTyxNQUFNLENBQUMsT0FBUCxDQUFBLENBQWdCLENBQUMsU0FBakIsQ0FBMkIsQ0FBM0IsRUFBOEIsTUFBTSxDQUFDLE9BQVAsQ0FBQSxDQUFnQixDQUFDLE1BQWpCLEdBQTBCLENBQXhELENBRFAsQ0FERjtPQUFBLE1BQUE7QUFJRSxRQUFBLElBQUEsR0FBTyxNQUFNLENBQUMsT0FBUCxDQUFBLENBQVAsQ0FKRjtPQUFBO0FBTUE7QUFDRSxRQUFBLE1BQUEsR0FBUyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVYsQ0FBbUIsSUFBbkIsQ0FBVCxDQUFBO2VBQ0EsTUFBTSxDQUFDLE9BQVAsQ0FBZSxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQVgsQ0FBaUIsTUFBakIsQ0FBd0IsQ0FBQyxRQUF6QixDQUFBLENBQUEsR0FBc0MsUUFBckQsRUFGRjtPQUFBLGNBQUE7QUFJRSxRQURJLGNBQ0osQ0FBQTtlQUFBLE9BQU8sQ0FBQyxJQUFSLENBQWEsS0FBYixFQUpGO09BcEJGO0tBVFU7RUFBQSxDQVJaLENBQUE7QUFBQSIKfQ==

//# sourceURL=/home/xy/.atom/packages/format-sql/lib/format-sql.coffee
