Object.defineProperty(exports, '__esModule', {
	value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/** @babel */

var _esformatter = require('esformatter');

var _esformatter2 = _interopRequireDefault(_esformatter);

var SUPPORTED_SCOPES = ['source.js', 'source.jsx', 'source.js.jsx'];

function init(editor, onSave) {
	if (!editor) {
		return;
	}

	var selectedText = onSave ? null : editor.getSelectedText();
	var text = selectedText || editor.getText();
	var retText = '';

	try {
		retText = _esformatter2['default'].format(text, _esformatter2['default'].rc(editor.getURI()));
	} catch (err) {
		console.error(err);
		atom.notifications.addError('esformatter', { detail: err.message });
		return;
	}

	var editorEl = atom.views.getView(editor);
	var cursorPosition = editor.getCursorBufferPosition();
	var line = editorEl.getFirstVisibleScreenRow() + editor.displayBuffer.getVerticalScrollMargin();

	if (selectedText) {
		editor.setTextInBufferRange(editor.getSelectedBufferRange(), retText);
	} else {
		editor.setText(retText);
	}

	editor.setCursorBufferPosition(cursorPosition);

	if (editor.getScreenLineCount() > line) {
		editor.scrollToScreenPosition([line, 0]);
	}
}

var config = {
	formatOnSave: {
		type: 'boolean',
		'default': false
	}
};

exports.config = config;
var activate = function activate() {
	atom.workspace.observeTextEditors(function (editor) {
		editor.getBuffer().onWillSave(function () {
			var isJS = SUPPORTED_SCOPES.indexOf(editor.getGrammar().scopeName) !== -1;

			if (isJS && atom.config.get('esformatter.formatOnSave')) {
				init(editor, true);
			}
		});
	});

	atom.commands.add('atom-workspace', 'esformatter', function () {
		init(atom.workspace.getActiveTextEditor());
	});
};
exports.activate = activate;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3h5Ly5hdG9tL3BhY2thZ2VzL2VzZm9ybWF0dGVyL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OzJCQUN3QixhQUFhOzs7O0FBRXJDLElBQU0sZ0JBQWdCLEdBQUcsQ0FDeEIsV0FBVyxFQUNYLFlBQVksRUFDWixlQUFlLENBQ2YsQ0FBQzs7QUFFRixTQUFTLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFO0FBQzdCLEtBQUksQ0FBQyxNQUFNLEVBQUU7QUFDWixTQUFPO0VBQ1A7O0FBRUQsS0FBTSxZQUFZLEdBQUcsTUFBTSxHQUFHLElBQUksR0FBRyxNQUFNLENBQUMsZUFBZSxFQUFFLENBQUM7QUFDOUQsS0FBTSxJQUFJLEdBQUcsWUFBWSxJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUM5QyxLQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7O0FBRWpCLEtBQUk7QUFDSCxTQUFPLEdBQUcseUJBQVksTUFBTSxDQUFDLElBQUksRUFBRSx5QkFBWSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztFQUNwRSxDQUFDLE9BQU8sR0FBRyxFQUFFO0FBQ2IsU0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNuQixNQUFJLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUUsRUFBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLE9BQU8sRUFBQyxDQUFDLENBQUM7QUFDbEUsU0FBTztFQUNQOztBQUVELEtBQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzVDLEtBQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO0FBQ3hELEtBQU0sSUFBSSxHQUFHLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLE1BQU0sQ0FBQyxhQUFhLENBQUMsdUJBQXVCLEVBQUUsQ0FBQzs7QUFFbEcsS0FBSSxZQUFZLEVBQUU7QUFDakIsUUFBTSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0VBQ3RFLE1BQU07QUFDTixRQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0VBQ3hCOztBQUVELE9BQU0sQ0FBQyx1QkFBdUIsQ0FBQyxjQUFjLENBQUMsQ0FBQzs7QUFFL0MsS0FBSSxNQUFNLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxJQUFJLEVBQUU7QUFDdkMsUUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7RUFDekM7Q0FDRDs7QUFFTSxJQUFNLE1BQU0sR0FBRztBQUNyQixhQUFZLEVBQUU7QUFDYixNQUFJLEVBQUUsU0FBUztBQUNmLGFBQVMsS0FBSztFQUNkO0NBQ0QsQ0FBQzs7O0FBRUssSUFBTSxRQUFRLEdBQUcsU0FBWCxRQUFRLEdBQVM7QUFDN0IsS0FBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxVQUFBLE1BQU0sRUFBSTtBQUMzQyxRQUFNLENBQUMsU0FBUyxFQUFFLENBQUMsVUFBVSxDQUFDLFlBQU07QUFDbkMsT0FBTSxJQUFJLEdBQUcsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzs7QUFFNUUsT0FBSSxJQUFJLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUMsRUFBRTtBQUN4RCxRQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ25CO0dBQ0QsQ0FBQyxDQUFDO0VBQ0gsQ0FBQyxDQUFDOztBQUVILEtBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLGFBQWEsRUFBRSxZQUFNO0FBQ3hELE1BQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQztFQUMzQyxDQUFDLENBQUM7Q0FDSCxDQUFDIiwiZmlsZSI6Ii9ob21lL3h5Ly5hdG9tL3BhY2thZ2VzL2VzZm9ybWF0dGVyL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqIEBiYWJlbCAqL1xuaW1wb3J0IGVzZm9ybWF0dGVyIGZyb20gJ2VzZm9ybWF0dGVyJztcblxuY29uc3QgU1VQUE9SVEVEX1NDT1BFUyA9IFtcblx0J3NvdXJjZS5qcycsXG5cdCdzb3VyY2UuanN4Jyxcblx0J3NvdXJjZS5qcy5qc3gnXG5dO1xuXG5mdW5jdGlvbiBpbml0KGVkaXRvciwgb25TYXZlKSB7XG5cdGlmICghZWRpdG9yKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Y29uc3Qgc2VsZWN0ZWRUZXh0ID0gb25TYXZlID8gbnVsbCA6IGVkaXRvci5nZXRTZWxlY3RlZFRleHQoKTtcblx0Y29uc3QgdGV4dCA9IHNlbGVjdGVkVGV4dCB8fCBlZGl0b3IuZ2V0VGV4dCgpO1xuXHRsZXQgcmV0VGV4dCA9ICcnO1xuXG5cdHRyeSB7XG5cdFx0cmV0VGV4dCA9IGVzZm9ybWF0dGVyLmZvcm1hdCh0ZXh0LCBlc2Zvcm1hdHRlci5yYyhlZGl0b3IuZ2V0VVJJKCkpKTtcblx0fSBjYXRjaCAoZXJyKSB7XG5cdFx0Y29uc29sZS5lcnJvcihlcnIpO1xuXHRcdGF0b20ubm90aWZpY2F0aW9ucy5hZGRFcnJvcignZXNmb3JtYXR0ZXInLCB7ZGV0YWlsOiBlcnIubWVzc2FnZX0pO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGNvbnN0IGVkaXRvckVsID0gYXRvbS52aWV3cy5nZXRWaWV3KGVkaXRvcik7XG5cdGNvbnN0IGN1cnNvclBvc2l0aW9uID0gZWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKCk7XG5cdGNvbnN0IGxpbmUgPSBlZGl0b3JFbC5nZXRGaXJzdFZpc2libGVTY3JlZW5Sb3coKSArIGVkaXRvci5kaXNwbGF5QnVmZmVyLmdldFZlcnRpY2FsU2Nyb2xsTWFyZ2luKCk7XG5cblx0aWYgKHNlbGVjdGVkVGV4dCkge1xuXHRcdGVkaXRvci5zZXRUZXh0SW5CdWZmZXJSYW5nZShlZGl0b3IuZ2V0U2VsZWN0ZWRCdWZmZXJSYW5nZSgpLCByZXRUZXh0KTtcblx0fSBlbHNlIHtcblx0XHRlZGl0b3Iuc2V0VGV4dChyZXRUZXh0KTtcblx0fVxuXG5cdGVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihjdXJzb3JQb3NpdGlvbik7XG5cblx0aWYgKGVkaXRvci5nZXRTY3JlZW5MaW5lQ291bnQoKSA+IGxpbmUpIHtcblx0XHRlZGl0b3Iuc2Nyb2xsVG9TY3JlZW5Qb3NpdGlvbihbbGluZSwgMF0pO1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XG5cdGZvcm1hdE9uU2F2ZToge1xuXHRcdHR5cGU6ICdib29sZWFuJyxcblx0XHRkZWZhdWx0OiBmYWxzZVxuXHR9XG59O1xuXG5leHBvcnQgY29uc3QgYWN0aXZhdGUgPSAoKSA9PiB7XG5cdGF0b20ud29ya3NwYWNlLm9ic2VydmVUZXh0RWRpdG9ycyhlZGl0b3IgPT4ge1xuXHRcdGVkaXRvci5nZXRCdWZmZXIoKS5vbldpbGxTYXZlKCgpID0+IHtcblx0XHRcdGNvbnN0IGlzSlMgPSBTVVBQT1JURURfU0NPUEVTLmluZGV4T2YoZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWUpICE9PSAtMTtcblxuXHRcdFx0aWYgKGlzSlMgJiYgYXRvbS5jb25maWcuZ2V0KCdlc2Zvcm1hdHRlci5mb3JtYXRPblNhdmUnKSkge1xuXHRcdFx0XHRpbml0KGVkaXRvciwgdHJ1ZSk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH0pO1xuXG5cdGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsICdlc2Zvcm1hdHRlcicsICgpID0+IHtcblx0XHRpbml0KGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKSk7XG5cdH0pO1xufTtcbiJdfQ==
//# sourceURL=/home/xy/.atom/packages/esformatter/index.js
